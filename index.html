<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SafeChild Mobile Tracker</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }
        
        body {
            background: #f5f7fa;
            color: #333;
            height: 100vh;
            overflow: hidden;
        }
        
        /* Login Screen */
        .login-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, #4fc3f7 0%, #2c3e50 100%);
        }
        
        .login-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
        }
        
        .app-logo {
            font-size: 2.5rem;
            color: #4fc3f7;
            margin-bottom: 10px;
        }
        
        .app-title {
            font-size: 1.8rem;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .app-subtitle {
            color: #7b8a8b;
            margin-bottom: 30px;
        }
        
        .login-form {
            margin-top: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #546e7a;
            font-weight: 600;
        }
        
        .form-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-input:focus {
            border-color: #4fc3f7;
            outline: none;
        }
        
        .login-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(to right, #4fc3f7, #29b6f6);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 10px;
        }
        
        .login-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .role-selector {
            display: flex;
            margin-bottom: 25px;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid #e0e0e0;
        }
        
        .role-option {
            flex: 1;
            padding: 12px;
            text-align: center;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            color: #7b8a8b;
        }
        
        .role-option.active {
            background: #4fc3f7;
            color: white;
        }
        
        /* Main App Container */
        .app-container {
            display: none;
            height: 100vh;
            flex-direction: column;
            background: #f5f7fa;
        }
        
        /* Header */
        .app-header {
            background: white;
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .hamburger-menu {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f0f4f8;
            color: #4fc3f7;
            font-size: 1.2rem;
            cursor: pointer;
        }
        
        .page-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #2c3e50;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4fc3f7, #29b6f6);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            background: white;
            display: flex;
            justify-content: space-around;
            padding: 15px 10px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
            z-index: 1000;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #7b8a8b;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 15px;
            transition: all 0.3s;
        }
        
        .nav-item.active {
            color: #4fc3f7;
            background: #e8f7ff;
        }
        
        .nav-icon {
            font-size: 1.3rem;
            margin-bottom: 5px;
        }
        
        .nav-label {
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            overflow-y: auto;
            padding-bottom: 70px;
        }
        
        /* Map Container */
        .map-container {
            width: 100%;
            height: 350px;
            position: relative;
        }
        
        #map {
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        .map-controls {
            position: absolute;
            bottom: 20px;
            right: 15px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .map-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: white;
            border: none;
            box-shadow: 0 3px 10px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #4fc3f7;
            font-size: 1.2rem;
            cursor: pointer;
        }
        
        /* Stats Cards */
        .stats-container {
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }
        
        .icon-safe {
            background: #4caf50;
        }
        
        .icon-total {
            background: #4fc3f7;
        }
        
        .icon-alert {
            background: #ff9800;
        }
        
        .icon-battery {
            background: #9c27b0;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #7b8a8b;
        }
        
        /* Children List */
        .children-container {
            padding: 0 20px 20px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .section-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2c3e50;
        }
        
        .children-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .child-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .child-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1.2rem;
        }
        
        .child-info {
            flex: 1;
        }
        
        .child-name {
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .child-details {
            font-size: 0.9rem;
            color: #7b8a8b;
            display: flex;
            gap: 10px;
        }
        
        .child-status {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        
        .status-safe {
            background: #4caf50;
        }
        
        .status-warning {
            background: #ff9800;
        }
        
        .status-danger {
            background: #f44336;
        }
        
        .status-text {
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        /* Alerts */
        .alerts-container {
            padding: 20px;
        }
        
        .alert-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            border-left: 5px solid;
        }
        
        .alert-warning {
            border-left-color: #ff9800;
        }
        
        .alert-danger {
            border-left-color: #f44336;
        }
        
        .alert-info {
            border-left-color: #4fc3f7;
        }
        
        .alert-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .alert-title {
            font-weight: 700;
            color: #2c3e50;
        }
        
        .alert-time {
            font-size: 0.85rem;
            color: #7b8a8b;
        }
        
        .alert-message {
            color: #546e7a;
            font-size: 0.95rem;
            margin-bottom: 15px;
        }
        
        .alert-actions {
            display: flex;
            gap: 10px;
        }
        
        .alert-btn {
            padding: 8px 15px;
            border-radius: 20px;
            border: none;
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
        }
        
        .btn-primary {
            background: #4fc3f7;
            color: white;
        }
        
        .btn-secondary {
            background: #f0f4f8;
            color: #546e7a;
        }
        
        /* SMS Controls */
        .sms-container {
            padding: 20px;
        }
        
        .sms-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        .sms-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .sms-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
        }
        
        .sms-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .sms-btn {
            padding: 12px;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        /* Settings */
        .settings-container {
            padding: 20px;
        }
        
        .settings-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #f0f4f8;
        }
        
        .settings-item:last-child {
            border-bottom: none;
        }
        
        .settings-label {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #4fc3f7;
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        /* Sidebar Menu */
        .sidebar {
            position: fixed;
            top: 0;
            left: -300px;
            width: 300px;
            height: 100%;
            background: white;
            box-shadow: 5px 0 15px rgba(0,0,0,0.1);
            z-index: 2000;
            transition: left 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        
        .sidebar.active {
            left: 0;
        }
        
        .sidebar-header {
            background: linear-gradient(135deg, #4fc3f7, #29b6f6);
            padding: 30px 20px;
            color: white;
        }
        
        .sidebar-user {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .sidebar-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .sidebar-info h3 {
            font-size: 1.3rem;
            margin-bottom: 5px;
        }
        
        .sidebar-info p {
            opacity: 0.9;
            font-size: 0.9rem;
        }
        
        .sidebar-menu {
            flex: 1;
            padding: 20px 0;
            overflow-y: auto;
        }
        
        .menu-item {
            display: flex;
            align-items: center;
            padding: 18px 25px;
            color: #546e7a;
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .menu-item:hover, .menu-item.active {
            background: #f0f4f8;
            color: #4fc3f7;
            border-left: 4px solid #4fc3f7;
        }
        
        .menu-icon {
            width: 24px;
            margin-right: 15px;
            font-size: 1.2rem;
        }
        
        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid #f0f4f8;
        }
        
        .logout-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            padding: 15px;
            background: #f0f4f8;
            border: none;
            border-radius: 10px;
            color: #f44336;
            font-weight: 600;
            cursor: pointer;
        }
        
        /* Overlay */
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1500;
        }
        
        .overlay.active {
            display: block;
        }
        
        /* Animations */
        .fade-in {
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Responsive */
        @media (min-width: 768px) {
            .app-container {
                max-width: 500px;
                margin: 0 auto;
                box-shadow: 0 0 20px rgba(0,0,0,0.1);
                height: 100vh;
            }
            
            .login-container {
                max-width: 450px;
            }
        }
        
        /* Hide scrollbar but keep functionality */
        .main-content::-webkit-scrollbar {
            display: none;
        }
        
        .main-content {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-container fade-in">
            <div class="app-logo">
                <i class="fas fa-child"></i>
            </div>
            <h1 class="app-title">SafeChild Tracker</h1>
            <p class="app-subtitle">School Children Monitoring System</p>
            
            <div class="role-selector">
                <div class="role-option active" data-role="parent">Parent</div>
                <div class="role-option" data-role="teacher">Teacher</div>
                <div class="role-option" data-role="admin">Admin</div>
            </div>
            
            <form class="login-form" id="loginForm">
                <div class="form-group">
                    <label class="form-label">Username / Email</label>
                    <input type="text" class="form-input" id="username" placeholder="Enter your username" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="password" placeholder="Enter your password" required>
                </div>
                
                <button type="submit" class="login-btn" id="loginButton">
                    <i class="fas fa-sign-in-alt"></i> Login to Track
                </button>
                
                <div style="margin-top: 20px; font-size: 0.9rem; color: #7b8a8b;">
                    <i class="fas fa-info-circle"></i> GF07 Device Tracking Enabled
                </div>
            </form>
        </div>
    </div>
    
    <!-- Main App -->
    <div class="app-container" id="appContainer">
        <!-- Header -->
        <div class="app-header">
            <div class="header-left">
                <div class="hamburger-menu" id="hamburgerMenu">
                    <i class="fas fa-bars"></i>
                </div>
                <div class="page-title" id="pageTitle">Live Tracking</div>
            </div>
            
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">JS</div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <!-- Dashboard Tab -->
            <div class="tab-content" id="dashboardTab">
                <!-- Map -->
                <div class="map-container">
                    <div id="map"></div>
                    <div class="map-controls">
                        <button class="map-btn" id="locateBtn">
                            <i class="fas fa-crosshairs"></i>
                        </button>
                        <button class="map-btn" id="zoomInBtn">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="map-btn" id="zoomOutBtn">
                            <i class="fas fa-minus"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Stats -->
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value" id="safeCount">12</div>
                                <div class="stat-label">Children Safe</div>
                            </div>
                            <div class="stat-icon icon-safe">
                                <i class="fas fa-check-circle"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value" id="totalCount">15</div>
                                <div class="stat-label">Total Tracked</div>
                            </div>
                            <div class="stat-icon icon-total">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value" id="alertCount">2</div>
                                <div class="stat-label">Active Alerts</div>
                            </div>
                            <div class="stat-icon icon-alert">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value" id="batteryLevel">87%</div>
                                <div class="stat-label">Avg. Battery</div>
                            </div>
                            <div class="stat-icon icon-battery">
                                <i class="fas fa-battery-three-quarters"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Children List -->
                <div class="children-container">
                    <div class="section-header">
                        <div class="section-title">Tracked Children</div>
                        <div style="color: #4fc3f7; font-weight: 600; font-size: 0.9rem;">
                            <i class="fas fa-sync-alt"></i> Live
                        </div>
                    </div>
                    
                    <div class="children-list" id="childrenList">
                        <!-- Children will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- Map Tab -->
            <div class="tab-content" id="mapTab" style="display: none;">
                <div class="map-container" style="height: 450px;">
                    <div id="fullMap"></div>
                    <div class="map-controls">
                        <button class="map-btn" id="fullLocateBtn">
                            <i class="fas fa-crosshairs"></i>
                        </button>
                    </div>
                </div>
                
                <div class="children-container">
                    <div class="section-header">
                        <div class="section-title">Child Locations</div>
                        <button class="btn-secondary" style="padding: 8px 15px; font-size: 0.9rem;">
                            <i class="fas fa-filter"></i> Filter
                        </button>
                    </div>
                    
                    <div class="children-list" id="mapChildrenList">
                        <!-- Children for map view -->
                    </div>
                </div>
            </div>
            
            <!-- Alerts Tab -->
            <div class="tab-content" id="alertsTab" style="display: none;">
                <div class="alerts-container">
                    <div class="section-header">
                        <div class="section-title">Recent Alerts</div>
                        <button class="btn-primary" style="padding: 8px 15px; font-size: 0.9rem;" id="markAllRead">
                            <i class="fas fa-check-double"></i> Mark All Read
                        </button>
                    </div>
                    
                    <div id="alertsList">
                        <!-- Alerts will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- SMS Tab -->
            <div class="tab-content" id="smsTab" style="display: none;">
                <div class="sms-container">
                    <div class="section-header">
                        <div class="section-title">GF07 Device Control</div>
                        <div style="color: #7b8a8b; font-size: 0.9rem;">
                            <i class="fas fa-satellite"></i> SMS Commands
                        </div>
                    </div>
                    
                    <div class="sms-card">
                        <div class="sms-form">
                            <select class="sms-input" id="deviceSelect">
                                <option value="">Select GF07 Device</option>
                                <option value="GF07-101">GF07-101 (Emma Wilson)</option>
                                <option value="GF07-102">GF07-102 (Noah Johnson)</option>
                                <option value="GF07-103">GF07-103 (Liam Brown)</option>
                                <option value="GF07-104">GF07-104 (Olivia Davis)</option>
                            </select>
                            
                            <select class="sms-input" id="commandSelect">
                                <option value="">Select SMS Command</option>
                                <option value="dw#123456">Get Location Now</option>
                                <option value="begin#123456">Start Real-time Tracking</option>
                                <option value="end#123456">Stop Tracking (Sleep)</option>
                                <option value="admin123456+138xxxxxxx">Set Admin Number</option>
                                <option value="speedalarm#123456#30">Set Speed Alarm (30km/h)</option>
                                <option value="tracker#123456#030">Set 30s Tracking Interval</option>
                                <option value="poweroff#123456">Power Off Device</option>
                            </select>
                            
                            <div class="sms-buttons">
                                <button class="sms-btn btn-primary" id="sendSmsBtn">
                                    <i class="fas fa-paper-plane"></i> Send Command
                                </button>
                                <button class="sms-btn btn-secondary" id="locationBtn">
                                    <i class="fas fa-map-marker-alt"></i> Get Location
                                </button>
                                <button class="sms-btn btn-secondary" id="batteryBtn">
                                    <i class="fas fa-battery-half"></i> Check Battery
                                </button>
                                <button class="sms-btn btn-secondary" id="trackBtn">
                                    <i class="fas fa-satellite-dish"></i> Start Tracking
                                </button>
                            </div>
                            
                            <div id="smsResult" style="display: none; padding: 15px; border-radius: 10px; margin-top: 15px;"></div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background: #e8f7ff; border-radius: 15px;">
                        <h4 style="color: #2c3e50; margin-bottom: 10px;">
                            <i class="fas fa-info-circle"></i> GF07 SMS Commands
                        </h4>
                        <p style="color: #546e7a; font-size: 0.9rem;">
                            Commands are sent directly to the device SIM. Default password is 123456. 
                            Replace with your device password.
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Settings Tab -->
            <div class="tab-content" id="settingsTab" style="display: none;">
                <div class="settings-container">
                    <div class="settings-card">
                        <h3 style="color: #2c3e50; margin-bottom: 20px;">
                            <i class="fas fa-bell"></i> Alert Settings
                        </h3>
                        
                        <div class="settings-item">
                            <div class="settings-label">Geo-fence Alerts</div>
                            <label class="switch">
                                <input type="checkbox" checked id="geofenceAlerts">
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="settings-label">Low Battery Alerts</div>
                            <label class="switch">
                                <input type="checkbox" checked id="batteryAlerts">
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="settings-label">Movement Alerts</div>
                            <label class="switch">
                                <input type="checkbox" id="movementAlerts">
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="settings-label">SOS Alerts</div>
                            <label class="switch">
                                <input type="checkbox" checked id="sosAlerts">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <h3 style="color: #2c3e50; margin-bottom: 20px;">
                            <i class="fas fa-map"></i> Tracking Settings
                        </h3>
                        
                        <div class="settings-item">
                            <div class="settings-label">Auto-refresh Map</div>
                            <label class="switch">
                                <input type="checkbox" checked id="autoRefresh">
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="settings-label">Live Tracking</div>
                            <label class="switch">
                                <input type="checkbox" checked id="liveTracking">
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="settings-label">Show School Zone</div>
                            <label class="switch">
                                <input type="checkbox" checked id="showSchoolZone">
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="settings-label">Show Bus Routes</div>
                            <label class="switch">
                                <input type="checkbox" id="showBusRoutes">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <h3 style="color: #2c3e50; margin-bottom: 20px;">
                            <i class="fas fa-user"></i> Account
                        </h3>
                        
                        <div class="settings-item">
                            <div class="settings-label">Logged in as</div>
                            <div style="color: #7b8a8b;" id="loggedInAs">Parent (Emma's Dad)</div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="settings-label">Tracking Role</div>
                            <div style="color: #4fc3f7; font-weight: 600;" id="trackingRole">Parent</div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="settings-label">Connected Devices</div>
                            <div style="color: #7b8a8b;" id="connectedDevices">3 GF07 Devices</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <a href="#" class="nav-item active" data-tab="dashboard">
                <div class="nav-icon">
                    <i class="fas fa-home"></i>
                </div>
                <div class="nav-label">Home</div>
            </a>
            
            <a href="#" class="nav-item" data-tab="map">
                <div class="nav-icon">
                    <i class="fas fa-map"></i>
                </div>
                <div class="nav-label">Map</div>
            </a>
            
            <a href="#" class="nav-item" data-tab="alerts">
                <div class="nav-icon">
                    <i class="fas fa-bell"></i>
                </div>
                <div class="nav-label">Alerts</div>
            </a>
            
            <a href="#" class="nav-item" data-tab="sms">
                <div class="nav-icon">
                    <i class="fas fa-sms"></i>
                </div>
                <div class="nav-label">SMS</div>
            </a>
            
            <a href="#" class="nav-item" data-tab="settings">
                <div class="nav-icon">
                    <i class="fas fa-cog"></i>
                </div>
                <div class="nav-label">Settings</div>
            </a>
        </div>
    </div>
    
    <!-- Sidebar Menu -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-user">
                <div class="sidebar-avatar" id="sidebarAvatar">JS</div>
                <div class="sidebar-info">
                    <h3 id="sidebarName">John Smith</h3>
                    <p id="sidebarRole">Parent • Tracking 1 Child</p>
                </div>
            </div>
        </div>
        
        <div class="sidebar-menu">
            <a href="#" class="menu-item active" data-tab="dashboard">
                <div class="menu-icon">
                    <i class="fas fa-tachometer-alt"></i>
                </div>
                Dashboard
            </a>
            
            <a href="#" class="menu-item" data-tab="map">
                <div class="menu-icon">
                    <i class="fas fa-map-marked-alt"></i>
                </div>
                Live Tracking Map
            </a>
            
            <a href="#" class="menu-item" data-tab="alerts">
                <div class="menu-icon">
                    <i class="fas fa-bell"></i>
                </div>
                Alerts & Notifications
                <span style="margin-left: auto; background: #f44336; color: white; padding: 3px 8px; border-radius: 10px; font-size: 0.8rem;" id="alertCountBadge">3</span>
            </a>
            
            <a href="#" class="menu-item" data-tab="sms">
                <div class="menu-icon">
                    <i class="fas fa-satellite-dish"></i>
                </div>
                GF07 Device Control
            </a>
            
            <a href="#" class="menu-item">
                <div class="menu-icon">
                    <i class="fas fa-history"></i>
                </div>
                Tracking History
            </a>
            
            <a href="#" class="menu-item">
                <div class="menu-icon">
                    <i class="fas fa-fence"></i>
                </div>
                Geo-fence Zones
            </a>
            
            <a href="#" class="menu-item">
                <div class="menu-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                Reports & Analytics
            </a>
            
            <a href="#" class="menu-item" data-tab="settings">
                <div class="menu-icon">
                    <i class="fas fa-cog"></i>
                </div>
                Settings
            </a>
            
            <a href="#" class="menu-item">
                <div class="menu-icon">
                    <i class="fas fa-question-circle"></i>
                </div>
                Help & Support
            </a>
        </div>
        
        <div class="sidebar-footer">
            <button class="logout-btn" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>
    </div>
    
    <!-- Overlay -->
    <div class="overlay" id="overlay"></div>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.min.js"></script>
    
    <script>
        // Global variables
        let map, fullMap;
        let currentUser = null;
        let childrenData = [];
        let markers = [];
        let userRole = 'parent'; // parent, teacher, admin
        let currentTab = 'dashboard';
        let updateInterval;
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initLoginScreen();
            initEventListeners();
            
            // Check if user is already logged in (for demo purposes)
            checkRememberedLogin();
        });
        
        // Initialize login screen
        function initLoginScreen() {
            // Role selector
            const roleOptions = document.querySelectorAll('.role-option');
            roleOptions.forEach(option => {
                option.addEventListener('click', function() {
                    roleOptions.forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    userRole = this.getAttribute('data-role');
                    
                    // Update placeholder text based on role
                    const usernameInput = document.getElementById('username');
                    if (userRole === 'parent') {
                        usernameInput.placeholder = 'Parent ID / Email';
                    } else if (userRole === 'teacher') {
                        usernameInput.placeholder = 'Teacher ID / Email';
                    } else {
                        usernameInput.placeholder = 'Admin Username';
                    }
                });
            });
            
            // Login form submission
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                loginUser();
            });
        }
        
        // Check for remembered login (demo)
        function checkRememberedLogin() {
            // In a real app, check localStorage or cookies
            const demoLogin = false; // Set to true for auto-login in demo
            
            if (demoLogin) {
                // Auto login for demo
                setTimeout(() => {
                    simulateLogin('parent', 'johnsmith');
                }, 1000);
            }
        }
        
        // Login user
        function loginUser() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (!username || !password) {
                showNotification('Please enter username and password', 'warning');
                return;
            }
            
            // Show loading state
            const loginBtn = document.getElementById('loginButton');
            const originalText = loginBtn.innerHTML;
            loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Logging in...';
            loginBtn.disabled = true;
            
            // Simulate login process
            setTimeout(() => {
                // In a real app, this would be an API call
                simulateLogin(userRole, username);
                
                // Reset button
                loginBtn.innerHTML = originalText;
                loginBtn.disabled = false;
            }, 1500);
        }
        
        // Simulate login (for demo)
        function simulateLogin(role, username) {
            // Create user based on role
            let user;
            
            if (role === 'parent') {
                user = {
                    id: 'parent_001',
                    name: username === 'johnsmith' ? 'John Smith' : username,
                    role: 'parent',
                    avatar: 'JS',
                    childCount: 1,
                    trackedChildren: ['Emma Wilson'],
                    school: 'Lincoln Elementary'
                };
            } else if (role === 'teacher') {
                user = {
                    id: 'teacher_001',
                    name: username === 'msjohnson' ? 'Ms. Johnson' : username,
                    role: 'teacher',
                    avatar: 'MJ',
                    childCount: 24,
                    trackedChildren: ['All Class 5B'],
                    school: 'Lincoln Elementary'
                };
            } else {
                user = {
                    id: 'admin_001',
                    name: 'School Admin',
                    role: 'admin',
                    avatar: 'SA',
                    childCount: 142,
                    trackedChildren: ['All Students'],
                    school: 'Lincoln Elementary'
                };
            }
            
            currentUser = user;
            
            // Show app and hide login
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('appContainer').style.display = 'flex';
            
            // Initialize app for this user
            initAppForUser();
            
            // Show welcome notification
            showNotification(`Welcome back, ${user.name}!`, 'success');
        }
        
        // Initialize app for logged in user
        function initAppForUser() {
            // Update UI with user info
            document.getElementById('userAvatar').textContent = currentUser.avatar;
            document.getElementById('sidebarAvatar').textContent = currentUser.avatar;
            document.getElementById('sidebarName').textContent = currentUser.name;
            document.getElementById('sidebarRole').textContent = `${currentUser.role.charAt(0).toUpperCase() + currentUser.role.slice(1)} • Tracking ${currentUser.childCount} ${currentUser.childCount === 1 ? 'Child' : 'Children'}`;
            
            document.getElementById('loggedInAs').textContent = `${currentUser.role.charAt(0).toUpperCase() + currentUser.role.slice(1)} (${currentUser.name})`;
            document.getElementById('trackingRole').textContent = currentUser.role.charAt(0).toUpperCase() + currentUser.role.slice(1);
            document.getElementById('connectedDevices').textContent = `${currentUser.childCount} GF07 ${currentUser.childCount === 1 ? 'Device' : 'Devices'}`;
            
            // Load appropriate data based on role
            loadChildrenData();
            
            // Initialize maps
            initMap();
            initFullMap();
            
            // Load initial content
            loadDashboardContent();
            
            // Start live updates
            startLiveUpdates();
        }
        
        // Initialize event listeners
        function initEventListeners() {
            // Bottom navigation
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Update active nav
                    navItems.forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show selected tab
                    const tab = this.getAttribute('data-tab');
                    switchTab(tab);
                });
            });
            
            // Sidebar menu items
            const menuItems = document.querySelectorAll('.menu-item');
            menuItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    if (this.hasAttribute('data-tab')) {
                        const tab = this.getAttribute('data-tab');
                        switchTab(tab);
                        
                        // Update bottom nav
                        navItems.forEach(nav => nav.classList.remove('active'));
                        document.querySelector(`.nav-item[data-tab="${tab}"]`).classList.add('active');
                    }
                    
                    // Close sidebar
                    closeSidebar();
                });
            });
            
            // Hamburger menu
            document.getElementById('hamburgerMenu').addEventListener('click', openSidebar);
            
            // Overlay click
            document.getElementById('overlay').addEventListener('click', closeSidebar);
            
            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', logout);
            
            // Map controls
            document.getElementById('locateBtn').addEventListener('click', locateUser);
            document.getElementById('zoomInBtn').addEventListener('click', () => map.zoomIn());
            document.getElementById('zoomOutBtn').addEventListener('click', () => map.zoomOut());
            document.getElementById('fullLocateBtn').addEventListener('click', locateUserOnFullMap);
            
            // SMS controls
            document.getElementById('sendSmsBtn').addEventListener('click', sendSmsCommand);
            document.getElementById('locationBtn').addEventListener('click', () => sendQuickCommand('dw#123456'));
            document.getElementById('batteryBtn').addEventListener('click', () => sendQuickCommand('battery#123456'));
            document.getElementById('trackBtn').addEventListener('click', () => sendQuickCommand('begin#123456'));
            
            // Mark all alerts as read
            document.getElementById('markAllRead').addEventListener('click', markAllAlertsRead);
        }
        
        // Switch between tabs
        function switchTab(tab) {
            // Hide all tabs
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.style.display = 'none');
            
            // Show selected tab
            document.getElementById(`${tab}Tab`).style.display = 'block';
            
            // Update page title
            const titles = {
                dashboard: 'Live Tracking',
                map: 'Tracking Map',
                alerts: 'Alerts',
                sms: 'Device Control',
                settings: 'Settings'
            };
            
            document.getElementById('pageTitle').textContent = titles[tab] || 'SafeChild Tracker';
            currentTab = tab;
            
            // Load tab-specific content
            if (tab === 'dashboard') {
                loadDashboardContent();
            } else if (tab === 'map') {
                loadMapContent();
            } else if (tab === 'alerts') {
                loadAlertsContent();
            } else if (tab === 'sms') {
                loadSmsContent();
            }
        }
        
        // Open sidebar menu
        function openSidebar() {
            document.getElementById('sidebar').classList.add('active');
            document.getElementById('overlay').classList.add('active');
        }
        
        // Close sidebar menu
        function closeSidebar() {
            document.getElementById('sidebar').classList.remove('active');
            document.getElementById('overlay').classList.remove('active');
        }
        
        // Logout user
        function logout() {
            // Clear current user
            currentUser = null;
            
            // Stop live updates
            clearInterval(updateInterval);
            
            // Reset login form
            document.getElementById('loginForm').reset();
            
            // Show login screen
            document.getElementById('appContainer').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'flex';
            
            // Close sidebar
            closeSidebar();
            
            // Show logout notification
            showNotification('You have been logged out', 'info');
        }
        
        // Initialize main map
        function initMap() {
            // School location (Lincoln Elementary)
            const schoolLocation = [40.7128, -74.0060];
            
            // Create map
            map = L.map('map').setView(schoolLocation, 15);
            
            // Add tile layer
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors',
                maxZoom: 19
            }).addTo(map);
            
            // Add school marker
            const schoolIcon = L.AwesomeMarkers.icon({
                icon: 'graduation-cap',
                markerColor: 'blue',
                prefix: 'fa'
            });
            
            L.marker(schoolLocation, { icon: schoolIcon })
                .addTo(map)
                .bindPopup('<b>Lincoln Elementary School</b><br>Safe Zone Center')
                .openPopup();
            
            // Add school zone circle
            L.circle(schoolLocation, {
                color: '#4fc3f7',
                fillColor: '#e8f7ff',
                fillOpacity: 0.3,
                radius: 500
            }).addTo(map).bindPopup('School Safe Zone (500m radius)');
        }
        
        // Initialize full map
        function initFullMap() {
            // School location
            const schoolLocation = [40.7128, -74.0060];
            
            // Create map
            fullMap = L.map('fullMap').setView(schoolLocation, 14);
            
            // Add tile layer
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors',
                maxZoom: 19
            }).addTo(fullMap);
            
            // Add school marker
            const schoolIcon = L.AwesomeMarkers.icon({
                icon: 'graduation-cap',
                markerColor: 'blue',
                prefix: 'fa'
            });
            
            L.marker(schoolLocation, { icon: schoolIcon })
                .addTo(fullMap)
                .bindPopup('<b>Lincoln Elementary School</b>');
            
            // Add school zone
            L.circle(schoolLocation, {
                color: '#4fc3f7',
                fillColor: '#e8f7ff',
                fillOpacity: 0.3,
                radius: 500
            }).addTo(fullMap).bindPopup('School Safe Zone');
        }
        
        // Load children data based on user role
        function loadChildrenData() {
            // Sample data - filtered based on user role
            const allChildren = [
                {
                    id: 1,
                    name: 'Emma Wilson',
                    grade: 'Grade 5A',
                    parent: 'John Smith',
                    deviceId: 'GF07-101',
                    location: [40.7145, -74.0082],
                    status: 'warning',
                    lastUpdate: '5 min ago',
                    battery: '78%',
                    phone: '+1 (555) 123-4567'
                },
                {
                    id: 2,
                    name: 'Noah Johnson',
                    grade: 'Grade 4B',
                    parent: 'Michael Johnson',
                    deviceId: 'GF07-102',
                    location: [40.7112, -74.0051],
                    status: 'safe',
                    lastUpdate: '2 min ago',
                    battery: '92%',
                    phone: '+1 (555) 234-5678'
                },
                {
                    id: 3,
                    name: 'Liam Brown',
                    grade: 'Grade 6C',
                    parent: 'James Brown',
                    deviceId: 'GF07-103',
                    location: [40.7135, -74.0038],
                    status: 'safe',
                    lastUpdate: '8 min ago',
                    battery: '65%',
                    phone: '+1 (555) 345-6789'
                },
                {
                    id: 4,
                    name: 'Olivia Davis',
                    grade: 'Grade 3A',
                    parent: 'Jennifer Davis',
                    deviceId: 'GF07-104',
                    location: [40.7160, -74.0075],
                    status: 'danger',
                    lastUpdate: '12 min ago',
                    battery: '24%',
                    phone: '+1 (555) 456-7890'
                }
            ];
            
            // Filter based on user role
            if (currentUser.role === 'parent') {
                // Parents only see their own children
                childrenData = allChildren.filter(child => 
                    child.parent.toLowerCase().includes(currentUser.name.toLowerCase().split(' ')[0])
                );
            } else {
                // Teachers and admins see all children
                childrenData = allChildren;
            }
            
            // Update counts
            document.getElementById('totalCount').textContent = childrenData.length;
            document.getElementById('safeCount').textContent = childrenData.filter(c => c.status === 'safe').length;
            document.getElementById('alertCount').textContent = childrenData.filter(c => c.status !== 'safe').length;
            
            // Calculate average battery
            const avgBattery = Math.round(childrenData.reduce((sum, child) => {
                return sum + parseInt(child.battery);
            }, 0) / childrenData.length);
            document.getElementById('batteryLevel').textContent = `${avgBattery}%`;
            
            // Update alert badge
            document.getElementById('alertCountBadge').textContent = childrenData.filter(c => c.status !== 'safe').length;
        }
        
        // Load dashboard content
        function loadDashboardContent() {
            // Clear existing markers from map
            markers.forEach(marker => marker.remove());
            markers = [];
            
            // Add child markers to map
            childrenData.forEach(child => {
                let markerColor;
                if (child.status === 'safe') markerColor = 'green';
                else if (child.status === 'warning') markerColor = 'orange';
                else markerColor = 'red';
                
                const childIcon = L.AwesomeMarkers.icon({
                    icon: 'child',
                    markerColor: markerColor,
                    prefix: 'fa'
                });
                
                const marker = L.marker(child.location, { icon: childIcon })
                    .addTo(map)
                    .bindPopup(`
                        <b>${child.name}</b><br>
                        Status: <span style="color: ${child.status === 'safe' ? 'green' : child.status === 'warning' ? 'orange' : 'red'}">${child.status.toUpperCase()}</span><br>
                        Battery: ${child.battery}<br>
                        Last Update: ${child.lastUpdate}<br>
                        <button onclick="centerOnChild(${child.id})" style="margin-top: 5px; padding: 5px 10px; background: #4fc3f7; color: white; border: none; border-radius: 3px; cursor: pointer;">Track</button>
                    `);
                
                markers.push(marker);
            });
            
            // Load children list
            loadChildrenList();
        }
        
        // Load children list
        function loadChildrenList() {
            const childrenList = document.getElementById('childrenList');
            childrenList.innerHTML = '';
            
            childrenData.forEach(child => {
                // Generate avatar color
                const avatarColor = getAvatarColor(child.name);
                
                // Status class
                let statusClass, statusText;
                if (child.status === 'safe') {
                    statusClass = 'status-safe';
                    statusText = 'Safe';
                } else if (child.status === 'warning') {
                    statusClass = 'status-warning';
                    statusText = 'Warning';
                } else {
                    statusClass = 'status-danger';
                    statusText = 'Alert';
                }
                
                const childElement = document.createElement('div');
                childElement.className = 'child-card';
                childElement.innerHTML = `
                    <div class="child-avatar" style="background-color: ${avatarColor}">
                        ${child.name.split(' ').map(n => n[0]).join('')}
                    </div>
                    <div class="child-info">
                        <div class="child-name">${child.name}</div>
                        <div class="child-details">
                            <span>${child.grade}</span>
                            <span>•</span>
                            <span>${child.deviceId}</span>
                            <span>•</span>
                            <span>${child.battery} battery</span>
                        </div>
                    </div>
                    <div class="child-status">
                        <div class="status-dot ${statusClass}"></div>
                        <div class="status-text">${statusText}</div>
                    </div>
                `;
                
                // Add click event to center map on child
                childElement.addEventListener('click', () => centerOnChild(child.id));
                
                childrenList.appendChild(childElement);
            });
        }
        
        // Load map content
        function loadMapContent() {
            // Clear existing markers from full map
            markers.forEach(marker => marker.remove());
            markers = [];
            
            // Add child markers to full map
            childrenData.forEach(child => {
                let markerColor;
                if (child.status === 'safe') markerColor = 'green';
                else if (child.status === 'warning') markerColor = 'orange';
                else markerColor = 'red';
                
                const childIcon = L.AwesomeMarkers.icon({
                    icon: 'child',
                    markerColor: markerColor,
                    prefix: 'fa'
                });
                
                const marker = L.marker(child.location, { icon: childIcon })
                    .addTo(fullMap)
                    .bindPopup(`
                        <b>${child.name}</b><br>
                        ${child.grade}<br>
                        Status: ${child.status.toUpperCase()}<br>
                        Battery: ${child.battery}<br>
                        Device: ${child.deviceId}
                    `);
                
                markers.push(marker);
            });
            
            // Load children list for map view
            loadMapChildrenList();
        }
        
        // Load children list for map view
        function loadMapChildrenList() {
            const mapChildrenList = document.getElementById('mapChildrenList');
            mapChildrenList.innerHTML = '';
            
            childrenData.forEach(child => {
                const avatarColor = getAvatarColor(child.name);
                
                let statusClass;
                if (child.status === 'safe') statusClass = 'status-safe';
                else if (child.status === 'warning') statusClass = 'status-warning';
                else statusClass = 'status-danger';
                
                const childElement = document.createElement('div');
                childElement.className = 'child-card';
                childElement.innerHTML = `
                    <div class="child-avatar" style="background-color: ${avatarColor}">
                        ${child.name.split(' ').map(n => n[0]).join('')}
                    </div>
                    <div class="child-info">
                        <div class="child-name">${child.name}</div>
                        <div class="child-details">
                            <span>${child.grade}</span>
                            <span>•</span>
                            <span>${child.lastUpdate}</span>
                        </div>
                    </div>
                    <div class="child-status">
                        <div class="status-dot ${statusClass}"></div>
                    </div>
                `;
                
                // Add click event to center map on child
                childElement.addEventListener('click', () => {
                    fullMap.setView(child.location, 17);
                    const marker = markers.find(m => 
                        m.getLatLng().lat === child.location[0] && 
                        m.getLatLng().lng === child.location[1]
                    );
                    if (marker) marker.openPopup();
                });
                
                mapChildrenList.appendChild(childElement);
            });
        }
        
        // Load alerts content
        function loadAlertsContent() {
            const alertsList = document.getElementById('alertsList');
            alertsList.innerHTML = '';
            
            // Get children with alerts
            const alertingChildren = childrenData.filter(child => child.status !== 'safe');
            
            if (alertingChildren.length === 0) {
                alertsList.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: #7b8a8b;">
                        <i class="fas fa-check-circle" style="font-size: 3rem; color: #4caf50; margin-bottom: 15px;"></i>
                        <h3>No Active Alerts</h3>
                        <p>All children are safe and accounted for</p>
                    </div>
                `;
                return;
            }
            
            alertingChildren.forEach(child => {
                let alertClass, alertTitle, alertIcon;
                
                if (child.status === 'warning') {
                    alertClass = 'alert-warning';
                    alertTitle = 'Movement Alert';
                    alertIcon = 'exclamation-triangle';
                } else {
                    alertClass = 'alert-danger';
                    alertTitle = 'Urgent Alert';
                    alertIcon = 'exclamation-circle';
                }
                
                const alertElement = document.createElement('div');
                alertElement.className = `alert-card ${alertClass}`;
                alertElement.innerHTML = `
                    <div class="alert-header">
                        <div class="alert-title">
                            <i class="fas fa-${alertIcon}"></i> ${alertTitle}
                        </div>
                        <div class="alert-time">${child.lastUpdate}</div>
                    </div>
                    <div class="alert-message">
                        <b>${child.name}</b> (${child.grade}) - ${child.deviceId}<br>
                        ${child.status === 'warning' ? 'Unusual movement detected' : 'Child left safe zone'} • Battery: ${child.battery}
                    </div>
                    <div class="alert-actions">
                        <button class="alert-btn btn-primary" onclick="centerOnChild(${child.id})">
                            <i class="fas fa-map-marker-alt"></i> View Location
                        </button>
                        <button class="alert-btn btn-secondary" onclick="callParent(${child.id})">
                            <i class="fas fa-phone"></i> Call Parent
                        </button>
                    </div>
                `;
                
                alertsList.appendChild(alertElement);
            });
        }
        
        // Load SMS content
        function loadSmsContent() {
            // Nothing special needed here
        }
        
        // Center map on child
        function centerOnChild(childId) {
            const child = childrenData.find(c => c.id === childId);
            if (!child) return;
            
            // Switch to map tab
            switchTab('map');
            
            // Update bottom nav
            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
            document.querySelector('.nav-item[data-tab="map"]').classList.add('active');
            
            // Center map on child
            fullMap.setView(child.location, 17);
            
            // Find and open marker popup
            setTimeout(() => {
                const marker = markers.find(m => 
                    m.getLatLng().lat === child.location[0] && 
                    m.getLatLng().lng === child.location[1]
                );
                if (marker) marker.openPopup();
            }, 300);
        }
        
        // Locate user on map
        function locateUser() {
            // In a real app, use device geolocation
            // For demo, center on school
            map.setView([40.7128, -74.0060], 15);
        }
        
        // Locate user on full map
        function locateUserOnFullMap() {
            fullMap.setView([40.7128, -74.0060], 14);
        }
        
        // Call parent
        function callParent(childId) {
            const child = childrenData.find(c => c.id === childId);
            if (!child) return;
            
            showNotification(`Calling ${child.parent} at ${child.phone}`, 'info');
            
            // In a real app, this would initiate a phone call
            // For demo, just show notification
        }
        
        // Send SMS command
        function sendSmsCommand() {
            const deviceSelect = document.getElementById('deviceSelect');
            const commandSelect = document.getElementById('commandSelect');
            const resultDiv = document.getElementById('smsResult');
            
            const device = deviceSelect.value;
            const command = commandSelect.value;
            
            if (!device || !command) {
                resultDiv.innerHTML = `<div style="background-color: #ffebee; color: #c62828; padding: 15px; border-radius: 10px;">
                    <i class="fas fa-exclamation-circle"></i> Please select both a device and a command.
                </div>`;
                resultDiv.style.display = 'block';
                return;
            }
            
            const commandName = commandSelect.options[commandSelect.selectedIndex].text;
            
            resultDiv.innerHTML = `<div style="background-color: #e8f5e9; color: #2e7d32; padding: 15px; border-radius: 10px;">
                <i class="fas fa-check-circle"></i> <b>SMS Command Sent!</b><br>
                <div style="margin-top: 10px;">
                    <b>Device:</b> ${device}<br>
                    <b>Command:</b> ${commandName}<br>
                    <b>SMS Text:</b> "${command}"<br>
                </div>
                <div style="margin-top: 10px; font-size: 0.9rem; color: #546e7a;">
                    <i class="fas fa-clock"></i> Allow 10-30 seconds for response
                </div>
            </div>`;
            resultDiv.style.display = 'block';
            
            // Clear selections
            deviceSelect.value = '';
            commandSelect.value = '';
            
            // Hide result after 5 seconds
            setTimeout(() => {
                resultDiv.style.display = 'none';
            }, 5000);
            
            // Show notification
            showNotification(`SMS command sent to ${device}`, 'success');
        }
        
        // Send quick command
        function sendQuickCommand(command) {
            const deviceSelect = document.getElementById('deviceSelect');
            const resultDiv = document.getElementById('smsResult');
            
            if (!deviceSelect.value) {
                resultDiv.innerHTML = `<div style="background-color: #ffebee; color: #c62828; padding: 15px; border-radius: 10px;">
                    <i class="fas fa-exclamation-circle"></i> Please select a device first.
                </div>`;
                resultDiv.style.display = 'block';
                setTimeout(() => {
                    resultDiv.style.display = 'none';
                }, 3000);
                return;
            }
            
            const device = deviceSelect.value;
            
            resultDiv.innerHTML = `<div style="background-color: #e8f5e9; color: #2e7d32; padding: 15px; border-radius: 10px;">
                <i class="fas fa-check-circle"></i> <b>Command Sent to ${device}</b><br>
                <div style="margin-top: 10px;">
                    <b>SMS:</b> "${command}"
                </div>
            </div>`;
            resultDiv.style.display = 'block';
            
            setTimeout(() => {
                resultDiv.style.display = 'none';
            }, 4000);
            
            showNotification(`Quick command sent to ${device}`, 'success');
        }
        
        // Mark all alerts as read
        function markAllAlertsRead() {
            // In a real app, update alert status in database
            
            // Update UI
            document.getElementById('alertCountBadge').textContent = '0';
            document.getElementById('alertCount').textContent = '0';
            
            // Update children status to safe (for demo)
            childrenData.forEach(child => {
                child.status = 'safe';
            });
            
            // Reload alerts
            loadAlertsContent();
            
            showNotification('All alerts marked as read', 'success');
        }
        
        // Start live updates
        function startLiveUpdates() {
            // Update data every 30 seconds
            updateInterval = setInterval(() => {
                updateLiveData();
            }, 30000);
        }
        
        // Update live data
        function updateLiveData() {
            // Simulate data updates
            childrenData.forEach(child => {
                // Randomly update last update time
                const minutes = Math.floor(Math.random() * 10) + 1;
                child.lastUpdate = `${minutes} min ago`;
                
                // Randomly change battery (decrease slightly)
                let battery = parseInt(child.battery);
                battery = Math.max(10, battery - Math.floor(Math.random() * 3));
                child.battery = `${battery}%`;
                
                // Occasionally change status (for demo)
                if (Math.random() > 0.85) {
                    const statuses = ['safe', 'warning', 'danger'];
                    child.status = statuses[Math.floor(Math.random() * statuses.length)];
                }
            });
            
            // Reload current view
            if (currentTab === 'dashboard') {
                loadDashboardContent();
            } else if (currentTab === 'map') {
                loadMapContent();
            } else if (currentTab === 'alerts') {
                loadAlertsContent();
            }
            
            // Update counts
            document.getElementById('safeCount').textContent = childrenData.filter(c => c.status === 'safe').length;
            document.getElementById('alertCount').textContent = childrenData.filter(c => c.status !== 'safe').length;
            document.getElementById('alertCountBadge').textContent = childrenData.filter(c => c.status !== 'safe').length;
            
            // Show update notification if on dashboard
            if (currentTab === 'dashboard') {
                showNotification('Live locations updated', 'info', 2000);
            }
        }
        
        // Show notification
        function showNotification(message, type = 'info', duration = 3000) {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background-color: ${type === 'success' ? '#4caf50' : type === 'warning' ? '#ff9800' : type === 'danger' ? '#f44336' : '#4fc3f7'};
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 2000;
                animation: slideDown 0.3s;
                max-width: 90%;
                text-align: center;
                font-weight: 600;
            `;
            
            // Add keyframes for animation
            const style = document.createElement('style');
            style.innerHTML = `
                @keyframes slideDown {
                    from { top: -100px; opacity: 0; }
                    to { top: 20px; opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Remove after duration
            setTimeout(() => {
                notification.style.animation = 'slideDown 0.3s reverse';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, duration);
        }
        
        // Get consistent avatar color based on name
        function getAvatarColor(name) {
            const colors = [
                '#4fc3f7', '#29b6f6', '#0288d1',
                '#4caf50', '#66bb6a', '#2e7d32',
                '#ff9800', '#ffb74d', '#f57c00',
                '#9c27b0', '#ba68c8', '#7b1fa2'
            ];
            
            let hash = 0;
            for (let i = 0; i < name.length; i++) {
                hash = name.charCodeAt(i) + ((hash << 5) - hash);
            }
            
            const index = Math.abs(hash) % colors.length;
            return colors[index];
        }
        
        // Demo login shortcut (for testing)
        // Press 'D' key for demo login
        document.addEventListener('keydown', function(e) {
            if (e.key === 'd' || e.key === 'D') {
                if (document.getElementById('loginScreen').style.display !== 'none') {
                    simulateLogin('parent', 'johnsmith');
                }
            }
        });
    </script>
</body>
</html>
